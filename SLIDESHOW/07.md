Mako Basics
=========

The __mako_basics_favorite_color.mako__ (*[source code](https://github.com/BrentNoorda/django_unusual/blob/master/django_unusual/mako/examples/mako_basics_favorite_color.mako]())*) page demonstrates the primary (in my opinion) uses of mako.

## "${...}" expression substition (with escaping)

Anywhere that __${expression}__ appears in HTML will be replaced with a text result of that expression. __expression__ may also be followed with an escape expression (e.g. "| h") for HTML rendering.

For example, __mako_basics_favorite_color.mako__ contains this code which print the value of the _popular_color_ variable, escaping any weird characters (such as "&" in "black&blue"):

    <p>The most popular color is ${ popular_color | h }</p>

And this example fills another cell with a link, substituting many variables and expressions:

    <td style="background-color:${ rgbattr(v['rgb'] )}">
        <a href="./mako_basics_favorite_color.mako?favorite=${ name | u}" style="color:${rgbattr(v['rgb'] ^ 0xFFFFFF)}">
            ${ name | h}
        </a>
    </td>


## "% ...control code..." python code lines

Any line whose first non-blank character is "%" is a single line of python control code. Usually this is control code (e.g. _if_, _for_, etc...) and the block must end with a matching _% end.._ (e.g. _% endif_, % endfor_, etc...)

__mako_basics_favorite_color.mako__ has this _%if_ example:

    % if popular_color is not None:
        <p>The most popular color is ${ popular_color | h }</p>
    % endif

and this _% for_ code

    % for name,v in gColors.items():
        ... a bunch of code here that can use the "name" and "v" variables ...
    % endfor

## "<% ... %>" embedded blocks of python

Any python code can be embedded between __<%...%>__ tags, and will execute within that spot of the html, using varibles, creating variables, causing havoc, etc...

For example, __mako_basics_favorite_color.mako__ contains this code block within the _%for_ loop mentioned previously:

    % for name,v in gColors.items():
        ... lots of code ...
        <%
            if (popular_color is None) or (gColors[popular_color]['votes'] < v['votes']):
                popular_color = name
        %>
        ... more code ...
    % endfor

It is common to have such a block near the top of the mako file, to evaluate the request object, verify user rights (maybe httpredirect and _return_ if there was a violation), and so on.

This is the code in __mako_basics_favorite_color.mako__ that initializes a variable and checks if the user entered a favorite color:

    <%
        popular_color = None

        previous_favorite = get_previous_favorite(request)

        if 'favorite' in request.GET:
            favorite_color = request.GET['favorite']
            gColors[favorite_color]['votes'] += 1    # this is bad code because of global stuff
            set_previous_favorite(request,favorite_color)
        else:
            favorite_color = None
    %>

## "<!% ... %>"module-level blocks of python

blah blah blah

------

&nbsp;&nbsp;&nbsp;&nbsp; [&lt;&lt; prev](06.md) -- [top](../README.md) -- [next &gt;&gt;](08.md)